(function(){var t={6848:function(t){t.exports={messages:{"11cb5ca38038c3eb41bd014814f6e2e18da18ff1":{text:"we don't accept any events",code:"READ_ONLY"},"1003d4ec1466033d0dcc4a1babc6c5f409784593":{text:"NIP-05 verification needed to publish events",code:"NIP_05_REQUIRED"},"2e36f6955db854ac51105aa198fdf37cec694135":{text:"[ERROR]: Pubkey is not whitelisted.",code:"WHITELIST_REQUIRED"},"5d6c9cb06d52c3f0456cc08fdf883dbe19b3c782":{text:"failed to save event from 5a462fa6044b4b8da318528a6987a45e3adf832bd1c64bd6910eacfecdf07541",code:"BLOCKS_WRITE_STATUS_CHECK"},"2c791b26eda3205558c235973ca84cc68a80e5e0":{text:"pubkey is not allowed to publish to this relay",code:"BLOCKS_WRITE_STATUS_CHECK"},"203442bfdf9f7f1562f1164b6dc79fefb42790ac":{text:'failed to save event 41ce9bc50da77dda5542f020370ecc2b056d8f2be93c1cedf1bf57efcab095b0: pq: duplicate key value violates unique constraint "ididx"',code:"BLOCKS_WRITE_STATUS_CHECK"},af155223f0e51dea64560c4ef6dc341a2775af76:{text:"failed to save event from 5a462fa6044b4b8da318528a6987a45e3adf832bd1c64bd6910eacfecdf07541",code:"BLOCKS_WRITE_STATUS_CHECK"}},codes:{READ_ONLY:{type:"write_restricted",description:"This relay only access read queries"},WRITE_ONLY:{type:"write_restricted",description:"This relay only accepts the publishing of events"},NIP_05_REQUIRED:{type:"write_restricted",description:"This relay only accepts the publishing of events from NIP-05 verified public keys"},WHITELIST_REQUIRED:{type:"write_restricted",description:"This relay onoly accepts the publishing of events from whitelisted public keys"},BLOCKS_WRITE_STATUS_CHECK:{type:"maybe_public",description:"This relay blocks the events that enable us to test writing to the relay, so there's some uncertainty"}}}},2237:function(t){t.exports={relays:["wss://rsslay.fiatjaf.com","wss://freedom-relay.herokuapp.com/ws","wss://nostr-relay.freeberty.net","wss://nostr.bitcoiner.social","wss://nostr-relay.wlvs.space","wss://nostr.onsats.org","wss://nostr-relay.untethr.me","wss://nostr.semisol.dev","wss://nostr-pub.semisol.dev","wss://nostr-verified.wellorder.net","wss://nostr.drss.io","wss://nostr.unknown.place","wss://relay.damus.io","wss://nostr.openchain.fr","wss://nostr.delo.software","wss://relay.nostr.info","wss://relay.minds.com/nostr/v1/ws","wss://nostr.zaprite.io","wss://nostr.oxtr.dev","wss://nostr.ono.re","wss://relay.grunch.dev","wss://relay.cynsar.foundation","wss://nostr-pub.wellorder.net","wss://relayer.fiatjaf.com","wss://nostr.rocks","wss://nostr.sandwich.farm"]}},7260:function(t,e,s){"use strict";var a=s(3862),n=s(3396);function i(t,e,s,a,i,l){const r=(0,n.up)("BaseRelays");return(0,n.wg)(),(0,n.j4)(r)}var l=s(7139);const r=t=>((0,n.dD)("data-v-d6bd2fc4"),t=t(),(0,n.Cn)(),t),o={class:"text-h5 text-bold q-py-md q-px-sm full-width flex row justify-start"},c=r((()=>(0,n._)("h1",null,"Nostr Relay Registry",-1))),d={key:0},u={class:"indicator badge readwrite"},g={key:0,class:"online"},h=r((()=>(0,n._)("tr",null,[(0,n._)("th"),(0,n._)("th"),(0,n._)("th",null,"🔌"),(0,n._)("th",null,"👁️‍🗨️"),(0,n._)("th",null,"✏️"),(0,n._)("th",null,"🌎"),(0,n._)("th",null,"⌛️"),(0,n._)("th",null,"ℹ️")],-1))),f=["onClick"],y={key:0},w={key:0},p={class:"indicator badge write-only"},_={class:"online"},b=r((()=>(0,n._)("tr",null,[(0,n._)("th"),(0,n._)("th"),(0,n._)("th",null,"🔌"),(0,n._)("th",null,"👁️‍🗨️"),(0,n._)("th",null,"✏️"),(0,n._)("th",null,"🌎"),(0,n._)("th",null,"⌛️"),(0,n._)("th",null,"ℹ️")],-1))),C=r((()=>(0,n._)("span",null,null,-1))),m=r((()=>(0,n._)("span",null,null,-1))),k=[C,m],v=["onClick"],R={key:0},D={key:0},S={class:"indicator badge offline"},E={key:0},T=r((()=>(0,n._)("tr",null,[(0,n._)("th"),(0,n._)("th"),(0,n._)("th",null,"🔌"),(0,n._)("th",null,"👁️‍🗨️"),(0,n._)("th",null,"✏️"),(0,n._)("th",null,"msg")],-1))),K={class:"left-align relay-url"},I=r((()=>(0,n._)("button",null,"log",-1)));function O(t,e,s,a,i,r){const C=(0,n.up)("Popper"),m=(0,n.up)("column"),O=(0,n.up)("row");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("div",o,[c,(0,n._)("span",null,"Next ping in "+(0,l.zw)(t.nextPing)+" seconds",1),(0,n.Uk)(" | "),t.relays.filter((e=>t.status[e]&&!t.status[e].complete)).length>0?((0,n.wg)(),(0,n.iD)("span",d,"Processing "+(0,l.zw)(t.relays.filter((e=>t.status[e].complete)).length)+"/"+(0,l.zw)(t.relays.length),1)):(0,n.kq)("",!0)]),(0,n.Wm)(O,{container:"",gutter:12},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{xs:12,md:12,lg:6},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n._)("h2",null,[(0,n._)("span",u,(0,l.zw)(t.query("public").length),1),(0,n.Uk)("Public")]),t.query("public").length>0?((0,n.wg)(),(0,n.iD)("table",g,[h,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.query("public"),(s=>((0,n.wg)(),(0,n.iD)("tr",{key:{relay:s},class:(0,l.C_)(t.getLoadingClass(s))},[((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"aggregate")},[(0,n._)("span",{class:(0,l.C_)(t.getAggregateStatusClass(s))},null,2)])),(0,n._)("td",{class:"left-align relay-url",onClick:e=>t.copy(s)},(0,l.zw)(s),9,f),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"didConnect")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(s,"didConnect"))},null,2)])),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"didRead")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(s,"didRead"))},null,2)])),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"didWrite")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(s,"didWrite"))},null,2)])),(0,n._)("td",null,(0,l.zw)(t.status[s].flag),1),(0,n._)("td",null,[t.status[s].didConnect?((0,n.wg)(),(0,n.iD)("span",y,[(0,n.Uk)((0,l.zw)(t.status[s].latency),1),t.status[s].latency?((0,n.wg)(),(0,n.iD)("span",w,"ms")):(0,n.kq)("",!0)])):(0,n.kq)("",!0)]),(0,n._)("td",null,[Object.keys(t.status[s].messages).length?((0,n.wg)(),(0,n.j4)(C,{key:0},{content:(0,n.w5)((()=>[(0,n._)("ul",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.status[s].messages,((e,a)=>((0,n.wg)(),(0,n.iD)("li",{key:t.generateKey(s,a)},(0,l.zw)(a),1)))),128))])])),default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(t.status[s].type)+" ",1),(0,n._)("button",{onMouseover:e[0]||(e[0]=(...e)=>t.showPopper&&t.showPopper(...e))},"log",32)])),_:2},1024)):(0,n.kq)("",!0)])],2)))),128))])):(0,n.kq)("",!0)])])),_:1}),(0,n.Wm)(m,{xs:12,md:12,lg:6},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n._)("h2",null,[(0,n._)("span",p,(0,l.zw)(t.query("restricted").length),1),(0,n.Uk)("Restricted")]),(0,n._)("table",_,[b,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.query("restricted"),(s=>((0,n.wg)(),(0,n.iD)("tr",{key:{relay:s},class:(0,l.C_)(t.getLoadingClass(s))},[((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"aggregate")},[(0,n._)("span",{class:(0,l.C_)(t.getAggregateStatusClass(s))},k,2)])),(0,n._)("td",{class:"left-align relay-url",onClick:e=>t.copy(s)},(0,l.zw)(s),9,v),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"didConnect")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(s,"didConnect"))},null,2)])),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"didRead")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(s,"didRead"))},null,2)])),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(s,"didWrite")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(s,"didWrite"))},null,2)])),(0,n._)("td",null,(0,l.zw)(t.status[s].flag),1),(0,n._)("td",null,[t.status[s].didConnect?((0,n.wg)(),(0,n.iD)("span",R,[(0,n.Uk)((0,l.zw)(t.status[s].latency),1),t.status[s].latency?((0,n.wg)(),(0,n.iD)("span",D,"ms")):(0,n.kq)("",!0)])):(0,n.kq)("",!0)]),(0,n._)("td",null,[Object.keys(t.status[s].messages).length?((0,n.wg)(),(0,n.j4)(C,{key:0},{content:(0,n.w5)((()=>[(0,n._)("ul",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.status[s].messages,((e,a)=>((0,n.wg)(),(0,n.iD)("li",{key:t.generateKey(s,a)},(0,l.zw)(a),1)))),128))])])),default:(0,n.w5)((()=>[(0,n._)("button",{onMouseover:e[1]||(e[1]=(...e)=>t.showPopper&&t.showPopper(...e))},"log",32)])),_:2},1024)):(0,n.kq)("",!0)])],2)))),128))]),(0,n._)("h2",null,[(0,n._)("span",S,(0,l.zw)(t.query("offline").length),1),(0,n.Uk)("Offline")]),t.query("offline").length>0?((0,n.wg)(),(0,n.iD)("table",E,[T,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.query("offline"),(e=>((0,n.wg)(),(0,n.iD)("tr",{key:{relay:e},class:(0,l.C_)(t.getLoadingClass(e))},[((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(e,"aggregate")},[(0,n._)("span",{class:(0,l.C_)(t.getAggregateStatusClass(e))},null,2)])),(0,n._)("td",K,(0,l.zw)(e),1),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(e,"didConnect")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(e,"didConnect"))},null,2)])),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(e,"didRead")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(e,"didRead"))},null,2)])),((0,n.wg)(),(0,n.iD)("td",{key:t.generateKey(e,"didWrite")},[(0,n._)("span",{class:(0,l.C_)(t.getStatusClass(e,"didWrite"))},null,2)])),(0,n._)("td",null,[Object.keys(t.status[e].messages).length?((0,n.wg)(),(0,n.j4)(C,{key:0},{content:(0,n.w5)((()=>[(0,n._)("ul",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.status[e].messages,((s,a)=>((0,n.wg)(),(0,n.iD)("li",{key:t.generateKey(e,a)},(0,l.zw)(a),1)))),128))])])),default:(0,n.w5)((()=>[I])),_:2},1024)):(0,n.kq)("",!0)])],2)))),128))])):(0,n.kq)("",!0)])])),_:1})])),_:1})])}var x=s(7708),W=s(1027),P=s(3758),q=s(1398),j=s.n(q),A=s(3944),L=s(5669),U=s.n(L),z=s(2237),H=s(6848),N=s(9821),Y=s(5941);const B=18e4;var $=(0,n.aZ)({name:"BaseRelays",components:{Row:W.X2,Column:W.sg,Popper:P.Z},data(){return{relays:z.relays,status:{},lastPing:Date.now(),nextPing:Date.now()+6e4,connections:{},latency:{}}},methods:{query(t){let e,s;return s=e=>this.status?.[e]?.aggregate==t,e=this.relays.filter(s),e.length?e.sort(((t,e)=>this.status?.[t]?.latency-this.status?.[e]?.latency)):[]},getAggregateStatusClass(t){let e="";return null==this.status?.[t]?.aggregate?e="unprocessed":"public"==this.status?.[t]?.aggregate?e="readwrite":"restricted"==this.status?.[t]?.aggregate?e=this.status?.[t]?.didWrite?"write-only":"read-only":"offline"==this.status?.[t]?.aggregate&&(e="offline"),`aggregate indicator ${e}`},getStatusClass(t,e){let s=!0===this.status?.[t]?.[e]?"green":!1===this.status?.[t]?.[e]?"red":"silver";return`indicator ${s}`},getLoadingClass(t){return this.status?.[t]?.complete?"relay loaded":"relay"},setAggregateStatus(t){let e=0;e+=this.status?.[t]?.didConnect?1:0,e+=this.status?.[t]?.didRead?1:0,e+=this.status?.[t]?.didWrite?1:0,this.status[t].aggregate=3==e?"public":0==e?"offline":"restricted"},async copy(t){try{await navigator.clipboard.writeText(t)}catch(e){Y.log("Cannot copy")}},setComplete(t){this.setAggregateStatus(t),this.status[t].complete=!0},generateKey(t,e){return`${t}_${e}`},testConnect(t){Y.log(t,"CONNECT","TEST"),this.connections[t]=(0,x.Relay)(t),this.connections[t].on("open",(e=>{Y.log("open",e),this.send({id:"41ce9bc50da77dda5542f020370ecc2b056d8f2be93c1cedf1bf57efcab095b0",pubkey:"5a462fa6044b4b8da318528a6987a45e3adf832bd1c64bd6910eacfecdf07541",created_at:1640305962,kind:1,tags:[],content:"running branle",sig:"08e6303565e9282f32bed41eee4136f45418f366c0ec489ef4f90d13de1b3b9fb45e14c74f926441f8155236fb2f6fef5b48a5c52b19298a0585a2c06afe39ed"}),this.subscribe(`read_test_${t}`,{limit:1,kinds:[1]})})).on("error",(t=>{Y.log("error",t)})).on("close",(t=>{Y.log("close",t)})).on("message",(e=>{Y.log(t,"CONNECT","SUCCESS");const s=this.sha1(e);let a=H.messages[s],n=H.codes[a.code];a.type=n.type,this.status[t].messages[e]=a,this.adjustStatus(t,s)}))},async testRead(t){let e;Y.dir(this.connections[t]),Y.log(t,"READ","TEST"),e=Date.now();let{unsub:s}=await this.connections[t].sub({cb:()=>{Y.log(t,"READ","SUCCESS"),this.status[t].didRead=!0,this.setComplete(t),this.latency[t].read=Date.now()-e,s(),clearTimeout(a)},filter:{ids:["41ce9bc50da77dda5542f020370ecc2b056d8f2be93c1cedf1bf57efcab095b0"]}},"nostr-registry"),a=setTimeout((()=>{s(),Y.log(t,"READ","FAILURE"),this.status[t].maybe_public||(this.status[t].didRead=!1),this.setComplete(t)}),1e4)},async testWrite(t){let e;Y.log(t,"WRITE","TEST"),e=Date.now(),await this.connections[t].publish(),this.latency[t].write=Date.now()-e},async testRelay(t){this.lastPing=Date.now(),this.latency[t]={},this.status[t].messages={};try{this.testConnect(t);try{await this.testWrite(t),Y.log(t,"WRITE","SUCCESS"),this.status[t].didWrite=!0}catch(e){Y.log(t,"WRITE","FAILURE"),this.status[t].didWrite=!1,this.setComplete(t)}this.testRead(t)}catch(e){this.status[t].didConnect=!1,this.setComplete(t)}this.status[t].didRead&&this.setLatency(t),await this.getIP(t),await this.setGeo(t),this.setFlag(t)},isOnion(t){return j()().test(t)},setLatency(t){this.status[t].latency=this.latency[t].read},testRelayLatency(){Y.log("testing latency"),this.relays.forEach((t=>{this.testRead(t,!0),this.setLatency(t)})),this.lastPing=Date.now()},async getIP(t){let e;await fetch(`https://1.1.1.1/dns-query?name=${t.replace("wss://","")}`,{headers:{accept:"application/dns-json"}}).then((t=>t.json())).then((t=>{e=!!t.Answer&&t.Answer[t.Answer.length-1].data})),this.status[t].ip=e,Y.log("IP:",e)},async setGeo(t){this.status[t].ip&&(await fetch(`http://ip-api.com/json/${this.status[t].ip}`,{headers:{accept:"application/dns-json"}}).then((t=>t.json())).then((e=>{this.status[t].geo=e})),Y.dir(this.status[t].geo))},setFlag(t){this.status[t].flag=this.status[t].geo?.countryCode?(0,A.ZP)(this.status[t].geo.countryCode):U().get("shrug")},adjustStatus(t,e){let s=H.messages[e].code,a=H.codes[s].type;this.status[t][a]=s,"maybe_public"==a&&(this.status[t].didWrite=!0,this.status[t].didRead=!0),"write_restricted"==a&&(this.status[t].didWrite=!1)},sha1(t){const e=N.createHash("sha1").update(JSON.stringify(t)).digest("hex");return e}},mounted(){this.relays.forEach((async t=>{this.status[t]={},this.isOnion(t)&&(t=`${t}.to`),await this.testRelay(t)}));setTimeout((()=>{this.testRelayLatency()}),1e4),setInterval((()=>{this.testRelayLatency()}),B),setInterval((()=>{this.nextPing=Math.round((this.lastPing+B-Date.now())/1e3)}),1e3)}}),F=s(89);const Z=(0,F.Z)($,[["render",O],["__scopeId","data-v-d6bd2fc4"]]);var M=Z,Q={name:"App",components:{BaseRelays:M}};const G=(0,F.Z)(Q,[["render",i]]);var J=G;(0,a.ri)(J).mount("#app")},6601:function(){},9214:function(){},1922:function(){},2363:function(){},9370:function(){},8325:function(){},2361:function(){},4616:function(){},8137:function(){},4656:function(){}},e={};function s(a){var n=e[a];if(void 0!==n)return n.exports;var i=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=t,function(){var t=[];s.O=function(e,a,n,i){if(!a){var l=1/0;for(d=0;d<t.length;d++){a=t[d][0],n=t[d][1],i=t[d][2];for(var r=!0,o=0;o<a.length;o++)(!1&i||l>=i)&&Object.keys(s.O).every((function(t){return s.O[t](a[o])}))?a.splice(o--,1):(r=!1,i<l&&(l=i));if(r){t.splice(d--,1);var c=n();void 0!==c&&(e=c)}}return e}i=i||0;for(var d=t.length;d>0&&t[d-1][2]>i;d--)t[d]=t[d-1];t[d]=[a,n,i]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var n,i,l=a[0],r=a[1],o=a[2],c=0;if(l.some((function(e){return 0!==t[e]}))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(o)var d=o(s)}for(e&&e(a);c<l.length;c++)i=l[c],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return s.O(d)},a=self["webpackChunknostr_relay_registry"]=self["webpackChunknostr_relay_registry"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(7260)}));a=s.O(a)})();
//# sourceMappingURL=app.27fea23d.js.map